import json
import re

# ==========================================
# 1. å®šç¾©è¦æ¨™è¨»çš„ã€Œæ©Ÿæ§‹åå–®ã€ (Target ORGs)
# ==========================================
# é€™äº›æœƒè¢«æ¨™è¨˜ç‚º B-ORG / I-ORG
# å…¶ä»–æ‰€æœ‰æ•¸å­—ã€å¹´ä»½ã€é«˜éµåéƒ½æœƒè‡ªå‹•è®Š Oï¼Œæœ‰æ•ˆæ¶ˆé™¤å¹»è¦º
target_orgs = [
    "ä¸­åœ‹åœ‹å®¶éµè·¯é›†åœ˜æœ‰é™å…¬å¸",
    "åœ‹éµé›†åœ˜"
]

# ==========================================
# 2. åŸå§‹æ–‡æœ¬
# ==========================================
raw_content = """æ“šä¸­åœ‹åœ‹å®¶éµè·¯é›†åœ˜æœ‰é™å…¬å¸ä»Šï¼ˆ4æ—¥ï¼‰æŠ«éœ²ï¼Œéµè·¯ã€Œåå››äº”ã€å¯¦ç¾åœ“æ»¿æ”¶å®˜ã€‚ã€Œåå››äº”ã€æœŸé–“ï¼Œå…¨åœ‹éµè·¯ç‡Ÿæ¥­é‡Œç¨‹ç”±14.63è¬å…¬é‡Œå¢è‡³16.5è¬å…¬é‡Œã€å¢é•·12.8%ï¼Œé«˜éµç”±3.79è¬å…¬é‡Œå¢è‡³5.04è¬å…¬é‡Œã€å¢é•·32.98%ï¼Œä¸­åœ‹å»ºæˆä¸–ç•Œè¦æ¨¡æœ€å¤§ã€å…ˆé€²ç™¼é”çš„é«˜é€Ÿéµè·¯ç¶²ã€‚

2025å¹´ï¼Œåœ‹éµé›†åœ˜åŠ å¿«å»ºè¨­ç¾ä»£åŒ–éµè·¯åŸºç¤è¨­æ–½é«”ç³»ï¼Œåœ“æ»¿å®Œæˆéµè·¯å»ºè¨­ä»»å‹™ï¼Œå…¨åœ‹éµè·¯å®Œæˆå›ºå®šè³‡ç”¢æŠ•è³‡9015å„„å…ƒäººæ°‘å¹£ã€åŒæ¯”å¢é•·6%ï¼ŒæŠ•ç”¢æ–°ç·š3109å…¬é‡Œï¼Œå…¶ä¸­é«˜éµ2862å…¬é‡Œï¼Œéµè·¯æŠ•è³‡æ‹‰å‹•ä½œç”¨å……åˆ†é¡¯ç¾ã€‚

2025å¹´ï¼Œåœ‹éµé›†åœ˜ä»¥åœ‹å®¶ã€Œåå››äº”ã€è¦åŠƒç¶±è¦ç¢ºå®šçš„102é …é‡å¤§å·¥ç¨‹éµè·¯é …ç›®å’Œã€Œå…©é‡ã€é …ç›®ç‚ºé‡é»ï¼ŒåŠ å¤§å¯¦æ–½åŠ›åº¦ï¼Œé•·è´›é«˜éµç­‰8å€‹é …ç›®é–‹å·¥å»ºè¨­ï¼Œç€‹ç™½é«˜éµç­‰25å€‹é …ç›®é–‹é€šé‹ç‡Ÿã€‚åŠ å¿«ç‰©æµåŸºç¤è¨­æ–½å»ºè¨­ï¼Œå»ºæˆéµè·¯å°ˆç”¨ç·š52æ¢ã€‚

ã€Œåäº”äº”ã€æœŸé–“ï¼Œåœ‹éµé›†åœ˜å°‡é€²ä¸€æ­¥æ¨é€²éµè·¯ç¶²å»ºè¨­ã€‚åˆ°2030å¹´ï¼Œå…¨åœ‹éµè·¯ç‡Ÿæ¥­é‡Œç¨‹é”åˆ°18è¬å…¬é‡Œå·¦å³ï¼Œå…¶ä¸­é«˜éµ6è¬å…¬é‡Œå·¦å³ï¼Œå¾©ç·šç‡å’Œé›»æ°£åŒ–ç‡åˆ†åˆ¥é”åˆ°64%å’Œ78%ï¼Œæˆ°ç•¥éª¨å¹¹é€šé“å…¨é¢åŠ å¼·ï¼Œã€Œå…«ç¸±å…«æ©«ã€é«˜éµç³»çµ±æˆç¶²ï¼Œå€åŸŸäº’è¯äº’é€šæ°´å¹³é¡¯è‘—æå‡ï¼Œè²¨é‹ç¶²çµ¡èƒ½åŠ›å¤§å¹…å¢å¼·ï¼ŒåŸºæœ¬å»ºæˆä¸–ç•Œä¸€æµçš„ç¾ä»£åŒ–éµè·¯ç¶²ã€‚

åŸæ–‡ç¶²å€ï¼šhttps://news.mingpao.com/ins/%E5%85%A9%E5%B2%B8/article/20260104/s00004/1767518315152"""

# ==========================================
# 3. è™•ç†é‚è¼¯
# ==========================================
def process_news(text):
    # A. ç°¡å–®æ¸…æ´— (ç§»é™¤ URLï¼Œå› ç‚º URL çµæ§‹å¤ªè¤‡é›œå®¹æ˜“å¹²æ“¾ ORG å­¸ç¿’ï¼Œé™¤éä½ æƒ³æ‰ URL è£¡é¢çš„ ORG)
    # é€™è£¡æˆ‘å€‘é¸æ“‡ç§»é™¤ "åŸæ–‡ç¶²å€ï¼š" ä¹‹å¾Œçš„éƒ¨åˆ†ï¼Œè®“æ¨¡å‹å°ˆæ³¨æ–¼å…§æ–‡
    if "åŸæ–‡ç¶²å€ï¼š" in text:
        text = text.split("åŸæ–‡ç¶²å€ï¼š")[0]

    # B. åˆ†å¥
    sentences = re.split(r'([ã€‚ï¼ï¼Ÿ\n])', text)
    segments = []
    current_sent = ""
    for s in sentences:
        current_sent += s
        if re.match(r'[ã€‚ï¼ï¼Ÿ\n]', s):
            if current_sent.strip():
                segments.append(current_sent.strip())
            current_sent = ""
    if current_sent.strip(): segments.append(current_sent.strip())

    # C. è‡ªå‹•æ¨™è¨»
    label2id = {
        "O": 0, "B-NAME": 1, "I-NAME": 2, 
        "B-ADDRESS": 3, "I-ADDRESS": 4, 
        "B-PHONE": 5, "I-PHONE": 6, 
        "B-ID": 7, "I-ID": 8, 
        "B-ACCOUNT": 9, "I-ACCOUNT": 10,
        "B-LICENSE_PLATE": 11, "I-LICENSE_PLATE": 12,
        "B-ORG": 13, "I-ORG": 14
    }

    final_data = []

    for sent in segments:
        tokens = list(sent)
        tags = [label2id["O"]] * len(tokens)
        
        # æ¨™è¨» ORG
        for org in target_orgs:
            for match in re.finditer(org, sent):
                start, end = match.span()
                tags[start] = label2id["B-ORG"]
                for i in range(start + 1, end):
                    tags[i] = label2id["I-ORG"]
        
        if len(tokens) > 0:
            final_data.append({
                "tokens": tokens,
                "ner_tags": tags
            })
            
    return final_data

# ==========================================
# 4. åŸ·è¡Œèˆ‡å„²å­˜
# ==========================================
news_json_data = process_news(raw_content)

output_file = "news_data.json"
with open(output_file, "w", encoding="utf-8") as f:
    json.dump(news_json_data, f, ensure_ascii=False, indent=2)

print(f"âœ… è™•ç†å®Œæˆï¼å…±ç”Ÿæˆ {len(news_json_data)} æ¢æ–°èæ•¸æ“šã€‚")
print(f"   - å·²æ¨™è¨» ORG: {target_orgs}")
print(f"   - å…¶ä»–æ•¸å­—ã€å¹´ä»½å·²è‡ªå‹•è¨­ç‚º O (è² æ¨£æœ¬)")
print(f"ğŸ“ æª”æ¡ˆå·²å„²å­˜ç‚º: {output_file}")